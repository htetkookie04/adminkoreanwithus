# Master Permission Control System - Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MASTER PERMISSION CONTROL SYSTEM                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚ â—„â”€â”€â”€â”€â”€â”€ â”‚   Backend    â”‚ â—„â”€â”€â”€â”€â”€â”€ â”‚   Database   â”‚
â”‚  (React TS)  â”‚   API   â”‚ (Express TS) â”‚   SQL   â”‚ (PostgreSQL) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                         â”‚                        â”‚
      â”‚                         â”‚                        â”‚
   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Layout â”‚              â”‚Controller â”‚         â”‚role_menu_      â”‚
   â”‚.tsx   â”‚              â”‚.ts        â”‚         â”‚permissions     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                         â”‚
   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚Settings   â”‚          â”‚Routes     â”‚
   â”‚.tsx       â”‚          â”‚.ts        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### 1. **User Login & Sidebar Rendering**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚  Logs In â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useAuthStore    â”‚
â”‚ stores user +   â”‚
â”‚ roleId          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layout.tsx                          â”‚
â”‚ useEffect(() => {                   â”‚
â”‚   fetchMenuPermissions()            â”‚
â”‚ }, [user?.roleId])                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ GET /api/menu-permissions/me
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend                             â”‚
â”‚ menuPermissionsController.ts        â”‚
â”‚ .getMyMenuPermissions()             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ SELECT * FROM role_menu_permissions
     â”‚ WHERE role_id = ? AND enabled = true
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database                            â”‚
â”‚ Returns: [                          â”‚
â”‚   { menuKey: 'dashboard', ... },    â”‚
â”‚   { menuKey: 'courses', ... }       â”‚
â”‚ ]                                   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layout.tsx                          â”‚
â”‚ setNavigation(menuItems)            â”‚
â”‚                                     â”‚
â”‚ Renders sidebar with only           â”‚
â”‚ allowed menus                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. **Admin Manages Permissions**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Super Admin   â”‚
â”‚ Goes to       â”‚
â”‚ Settings      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Settings.tsx                       â”‚
â”‚ Renders:                           â”‚
â”‚ - Admin Settings âœ…                â”‚
â”‚ - Role Menu Permissions âœ…         â”‚
â”‚ - Change Password âœ…               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RoleMenuPermissions.tsx            â”‚
â”‚                                    â”‚
â”‚ 1. Fetch roles                     â”‚
â”‚ 2. Fetch available menus           â”‚
â”‚ 3. Fetch current role menus        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ GET /api/roles
        â”‚ GET /api/menu-permissions/available-menus
        â”‚ GET /api/menu-permissions/role/:roleId
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend APIs                       â”‚
â”‚ Returns data for UI                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin checks/unchecks menus        â”‚
â”‚ Clicks "Save Permissions"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ PUT /api/menu-permissions/role/:roleId
        â”‚ Body: { menuPermissions: [...] }
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend                            â”‚
â”‚ updateRoleMenuPermissions()        â”‚
â”‚                                    â”‚
â”‚ 1. DELETE old permissions          â”‚
â”‚ 2. INSERT new permissions          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ BEGIN TRANSACTION
        â”‚ DELETE FROM role_menu_permissions WHERE role_id = ?
        â”‚ INSERT INTO role_menu_permissions VALUES (...)
        â”‚ COMMIT
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Updated                   â”‚
â”‚                                    â”‚
â”‚ âœ… Changes saved                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next time user with that role      â”‚
â”‚ logs in or refreshes page:         â”‚
â”‚ Sidebar shows updated menus        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                role_menu_permissions                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Column       â”‚ Type         â”‚ Description               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚ SERIAL       â”‚ Primary Key               â”‚
â”‚ role_id      â”‚ INT          â”‚ FK â†’ roles(id)           â”‚
â”‚ menu_key     â”‚ TEXT         â”‚ Unique identifier         â”‚
â”‚ menu_label   â”‚ TEXT         â”‚ Display name              â”‚
â”‚ menu_path    â”‚ TEXT         â”‚ Route path                â”‚
â”‚ menu_icon    â”‚ TEXT         â”‚ Icon name (lucide-react)  â”‚
â”‚ sort_order   â”‚ INT          â”‚ Display order             â”‚
â”‚ enabled      â”‚ BOOLEAN      â”‚ Active/Inactive           â”‚
â”‚ created_at   â”‚ TIMESTAMPTZ  â”‚ Creation time             â”‚
â”‚ updated_at   â”‚ TIMESTAMPTZ  â”‚ Last update time          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Indexes:
  - PRIMARY KEY (id)
  - UNIQUE (role_id, menu_key)
  - INDEX (role_id)
  - INDEX (enabled)

Constraints:
  - FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE
```

---

## Component Hierarchy

```
App.tsx
  â””â”€â”€ Layout.tsx â­ (Dynamic Sidebar)
       â”œâ”€â”€ Logo & Header
       â”œâ”€â”€ Navigation (Dynamic) ğŸ”„
       â”‚    â”œâ”€â”€ Fetches menu permissions from API
       â”‚    â”œâ”€â”€ Maps permissions to menu items
       â”‚    â””â”€â”€ Renders allowed menus only
       â”œâ”€â”€ User Info
       â”œâ”€â”€ Logout Button
       â””â”€â”€ <Outlet /> (Child Routes)
            â””â”€â”€ Settings.tsx â­ (Conditional Sections)
                 â”œâ”€â”€ Admin Settings (Super Admin Only) ğŸ”’
                 â”œâ”€â”€ Change Password (All Users) âœ…
                 â””â”€â”€ RoleMenuPermissions.tsx â­ (Super Admin Only) ğŸ”’
                      â”œâ”€â”€ Role Selector
                      â”œâ”€â”€ Available Menus List
                      â”œâ”€â”€ Checkbox for each menu
                      â”œâ”€â”€ Selected Menus Preview
                      â””â”€â”€ Save Button
```

---

## Access Control Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚ Super Admin â”‚ Admin â”‚ Teacher â”‚ Others  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Admin Settings     â”‚      âœ…     â”‚   âŒ  â”‚    âŒ   â”‚    âŒ   â”‚
â”‚ (Contact Email)    â”‚             â”‚       â”‚         â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Role Menu          â”‚      âœ…     â”‚   âŒ  â”‚    âŒ   â”‚    âŒ   â”‚
â”‚ Permissions        â”‚             â”‚       â”‚         â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User Roles List    â”‚      âœ…     â”‚   âœ…  â”‚    âŒ   â”‚    âŒ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Change Password    â”‚      âœ…     â”‚   âœ…  â”‚    âœ…   â”‚    âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Frontend State                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Layout.tsx                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ const [navigation, setNavigation] =     â”‚                   â”‚
â”‚  â”‚   useState<MenuItem[]>([])              â”‚                   â”‚
â”‚  â”‚                                         â”‚                   â”‚
â”‚  â”‚ const [loading, setLoading] =           â”‚                   â”‚
â”‚  â”‚   useState(true)                        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â”‚  RoleMenuPermissions.tsx                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ const [selectedRoleId, setSelectedRoleId]â”‚                  â”‚
â”‚  â”‚   = useState<number | null>(null)       â”‚                   â”‚
â”‚  â”‚                                         â”‚                   â”‚
â”‚  â”‚ const [availableMenus, setAvailableMenus]â”‚                  â”‚
â”‚  â”‚   = useState<MenuItem[]>([])            â”‚                   â”‚
â”‚  â”‚                                         â”‚                   â”‚
â”‚  â”‚ const [selectedMenus, setSelectedMenus] â”‚                   â”‚
â”‚  â”‚   = useState<RoleMenuPermission[]>([])  â”‚                   â”‚
â”‚  â”‚                                         â”‚                   â”‚
â”‚  â”‚ const [saving, setSaving] = useState(false)â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoint Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API Routes                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  /api/menu-permissions                                          â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ GET  /me                                                 â”‚
â”‚    â”‚        â†³ getMyMenuPermissions()                           â”‚
â”‚    â”‚          Returns: Current user's allowed menus            â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ GET  /available-menus                                    â”‚
â”‚    â”‚        â†³ getAvailableMenus()                              â”‚
â”‚    â”‚          Returns: Master list of all menus                â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ GET  /                                                   â”‚
â”‚    â”‚        â†³ getAllMenuPermissions()                          â”‚
â”‚    â”‚          Returns: All role-menu mappings                  â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ GET  /role/:roleId                                       â”‚
â”‚    â”‚        â†³ getRoleMenuPermissions()                         â”‚
â”‚    â”‚          Returns: Menus for specific role                 â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ PUT  /role/:roleId                                       â”‚
â”‚    â”‚        â†³ updateRoleMenuPermissions()                      â”‚
â”‚    â”‚          Body: { menuPermissions: [...] }                 â”‚
â”‚    â”‚          Action: Replaces all menus for role              â”‚
â”‚    â”‚                                                            â”‚
â”‚    â””â”€â”€ PATCH /:id/toggle                                        â”‚
â”‚             â†³ toggleMenuPermission()                           â”‚
â”‚               Action: Enable/Disable single menu               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Request    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Authorization: Bearer <JWT>
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authenticate() middleware    â”‚
â”‚                              â”‚
â”‚ 1. Extract JWT from header   â”‚
â”‚ 2. Verify JWT signature      â”‚
â”‚ 3. Decode user info          â”‚
â”‚ 4. Attach req.user           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ req.user = { id, email, roleId, roleName }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller                   â”‚
â”‚                              â”‚
â”‚ 1. Check req.user            â”‚
â”‚ 2. Validate permissions      â”‚
â”‚ 3. Query database            â”‚
â”‚ 4. Return filtered data      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Response   â”‚
â”‚   (JSON)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
API Call
  â”‚
  â”œâ”€ Success? â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Update UI
  â”‚                      âœ… Show success toast
  â”‚                      âœ… Refresh data
  â”‚
  â””â”€ Error? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Handle Error
                          â”œâ”€ Network Error
                          â”‚  â””â”€â–º Show "Failed to connect" message
                          â”‚
                          â”œâ”€ 401 Unauthorized
                          â”‚  â””â”€â–º Redirect to login
                          â”‚
                          â”œâ”€ 403 Forbidden
                          â”‚  â””â”€â–º Show "No permission" message
                          â”‚
                          â”œâ”€ 404 Not Found
                          â”‚  â””â”€â–º Show "Resource not found"
                          â”‚
                          â”œâ”€ 500 Server Error
                          â”‚  â””â”€â–º Show "Server error" + fallback
                          â”‚
                          â””â”€ Other
                             â””â”€â–º Show generic error message
```

---

## Deployment Flow

```
1. Development
   â”œâ”€ Write code
   â”œâ”€ Test locally
   â””â”€ Commit to Git

2. Database Migration
   â”œâ”€ Run: npx prisma db push
   â”œâ”€ Generate client: npx prisma generate
   â””â”€ Verify: Check table exists

3. Backend Deployment
   â”œâ”€ Build: npm run build
   â”œâ”€ Test: npm run dev
   â””â”€ Deploy: Push to production

4. Frontend Deployment
   â”œâ”€ Build: npm run build
   â”œâ”€ Test: npm run preview
   â””â”€ Deploy: Push to hosting (Netlify/Vercel)

5. Verification
   â”œâ”€ Login as Super Admin
   â”œâ”€ Test Role Menu Permissions
   â”œâ”€ Test as different roles
   â””â”€ Monitor logs for errors
```

---

## Performance Considerations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Optimization Points                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. Database Indexes âœ…                                  â”‚
â”‚     â€¢ role_id indexed for fast lookups                   â”‚
â”‚     â€¢ enabled indexed for filtering                      â”‚
â”‚     â€¢ Unique constraint prevents duplicates              â”‚
â”‚                                                          â”‚
â”‚  2. API Caching (Future)                                 â”‚
â”‚     â€¢ Cache menu permissions per role                    â”‚
â”‚     â€¢ Invalidate on permission update                    â”‚
â”‚     â€¢ TTL: 5 minutes                                     â”‚
â”‚                                                          â”‚
â”‚  3. Frontend Caching                                     â”‚
â”‚     â€¢ Store menu permissions in state                    â”‚
â”‚     â€¢ Only fetch on role change                          â”‚
â”‚     â€¢ Local storage for offline fallback                 â”‚
â”‚                                                          â”‚
â”‚  4. Query Optimization                                   â”‚
â”‚     â€¢ Use SELECT only needed columns                     â”‚
â”‚     â€¢ WHERE enabled = true reduces results               â”‚
â”‚     â€¢ ORDER BY sort_order for efficient sorting          â”‚
â”‚                                                          â”‚
â”‚  5. Bundle Size                                          â”‚
â”‚     â€¢ Icons imported individually (tree-shaking)         â”‚
â”‚     â€¢ Code splitting for role management UI              â”‚
â”‚     â€¢ Lazy load RoleMenuPermissions component            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Future Enhancements

```
Phase 2 (Optional):
  â”œâ”€ Drag & drop menu reordering UI
  â”œâ”€ Permission templates/presets
  â”œâ”€ Audit log for permission changes
  â”œâ”€ Bulk copy permissions between roles
  â”œâ”€ Permission inheritance (role hierarchy)
  â”œâ”€ Sub-menu / nested menu support
  â”œâ”€ Menu visibility conditions (feature flags)
  â””â”€ A/B testing for menu layouts
```

---

This architecture provides a scalable, maintainable, and secure foundation for dynamic menu management! ğŸš€

